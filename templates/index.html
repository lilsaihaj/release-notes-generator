
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>Jumbotron Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Page Specific CSS -->
    <link href="/static/css/index.css" rel="stylesheet">


  </head>

  <body>

	<div class="ajax-indicator">
		<div class="loading">
  			<span class="glyphicon glyphicon-refresh"></span> Loading
  		</div>
  		<div class="complete">
  			<span class="glyphicon glyphicon-ok"></span> Complete
  		</div>
  		<div class="error">
  			<span class="glyphicon glyphicon-ban-circle"></span> Error!
  		</div>
  	</div>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>

          <a class="navbar-brand" href="#">
          	<span><img src="http://www.jdsmitproductions.co.nz/img/sharethis.png" style="width:21px;width: 21px;
vertical-align: top;" /></span>
          	Release Notes Generator
          </a>
        </div>
      </div>
    </div>



    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
        <h1>Let the public know!</h1>
        <p>Use the form below to search for a group of issues within JIRA. Then take the results and easily craft a release update to your user's Twitter group and GetSatisfaction.</p>
        <!--<p><a class="btn btn-primary btn-lg" role="button">Learn more &raquo;</a></p>-->

		<form class="" role="search" onsubmit="search();return false;">
		<div class="row">
		  <div class="col-lg-8">

		    <div class="input-group">
		      	<input type="text" id="jql-search-str" class="form-control" placeholder="Enter your JIRA JQL Query" />

			      <span class="input-group-btn">
			        
			        <button class="btn btn-default" type="submit">Search</button>

			        <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" type="button">
			        	<span class="caret"></span>
			        </button>
			        <ul class="dropdown-menu">
			          <li><a href="javascript://" onclick="populate_sz_api();">Socialize API Accepted Tickets</a></li>
			          <li><a href="javascript://" onclick="populate_sz_web();">Socialize Web Accepted Tickets</a></li>
			          <li class="divider"></li>
			          <li><a href="#">Save</a></li>
			        </ul>

			        
			      
			      </span><!-- input-group-btn -->
		    </div><!-- /input-group -->
		  </div><!-- /.col-lg-8 -->
		</div><!-- /.row -->
		</form>
      	
      	<div id="jql-error-query-message" class="alert alert-warning" style="display:none;margin-top:8px;position:absolute;padding:5px;"></div>
      
      </div><!-- container -->
    </div><!-- jumbotron -->

    <div class="container">
    	<h2>Issues <small></small></h2>

    	<form role="form">

		<table id="issues" class="table table-striped table-hover">
			<thead>
				<td>ID</td>
				<td>Summary</td>
				<td>Publicize</td>
			</thead>
			<tbody>
			</tbody>
		</table>

		
		  <fieldset>
		    <button type="submit" class="btn btn-primary pull-right">Generate Post</button>
		  </fieldset>

		</form>

	</div><!-- container -->





    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>

    <script>

		$( document ).ready(function() {
		    console.log( "ready!" );
		});

		function populate_sz_web(){
			search_str = 'Sprint="Sprint 146" AND status=accepted AND project=SWEB'
			$("#jql-search-str").val(search_str);
		}

		function populate_sz_api(){
			search_str = 'Sprint="Sprint 146" AND status=accepted AND project=SAPI'
			$("#jql-search-str").val(search_str);
		}

		function search(){
			$(".ajax-indicator .loading").show();
			// Using the core $.ajax() method
			$.ajax({
			    // the URL for the request
			    url: "/get_issues",
			 
			    // the data to send (will be converted to a query string)
			    data: {
			        jql: encodeURIComponent($("#jql-search-str").val())
			    },
			 
			    // whether this is a POST or GET request
			    type: "GET",
			 
			    // the type of data we expect back
			    dataType : "json",
			 
			    // code to run if the request succeeds;
			    // the response is passed to the function
			    success: function( json ) {
					  if (json.errorMessages){
					  	handleError();
					  	$("#jql-error-query-message").show().html(json.errorMessages[0]).delay(3000).fadeOut(200);
					  	
					  }else{
					  	$('#issues tbody').html("");
					  	jQuery.each(json.issues, function(i, issue) {
	 				  		  //console.log(issue.key + " " + issue.self + " " + issue.fields.summary)
							  key = "<td><a href='" + issue.self + "'>" + issue.key + "</a></td>"
							  summary = "<td>" + issue.fields.summary + "</td>"
							  publicize = "<td><input type=\"checkbox\" checked=checked></td>"
							  
							  $('#issues tbody:last').append('<tr>' + key + summary + publicize + '</tr>');
						  });
					  	$(".ajax-indicator .loading").hide();
			    		$(".ajax-indicator .complete").show().fadeOut("slow");
					  }
			    },
			    // code to run regardless of success or failure
			    // complete: function( xhr, status ) {
			    // 	$(".ajax-indicator .loading").hide();
			    // 	$(".ajax-indicator .complete").show().fadeOut("slow");
			    // },
			    // code to run if the request fails; the raw request and
			    // status codes are passed to the function
			    error:handleError
			});
			
			function handleError(xhr, status, error ){
				
			    	$(".ajax-indicator .loading").hide();
			        $(".ajax-indicator .error").show().fadeOut("slow");
			    
			}
		}
    </script>
  </body>
</html>
